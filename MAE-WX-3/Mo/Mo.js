var defaultConfig={},define=function(a,b){defaultConfig[a.toUpperCase()]=b};var F,JSON,require,VBS,View,Model__,req=Request,res=Response,ROOT=Server.Mappath("/"),Mo,startup=Mo=Mo||(function(){var v=function(c){if(typeof c!="string"){return""}if(c.substr(1,1)==":"){return c}return Server.MapPath(c)};var o="",n={},w={};var g=function(z,y){for(var A in y){if(y.hasOwnProperty(A)){z[A]=y[A]}}return z};var u=function(z,y){var c=0;while(true){if(c>=z.length||c>=y.length){break}z[z.length-c-1]=y[y.length-c-1];c++}return z};var b=function(C,G){var y,B,D,c;G=!!G;y=C.split(":");if(y.length==1){B=q.MO_TEMPLATE_NAME+"/"+k.Method+q.MO_TEMPLATE_SPLIT+C;y=[q.MO_TEMPLATE_NAME,k.Method,C]}else{if(y.length==2){B=q.MO_TEMPLATE_NAME+"/"+C.replace(":",q.MO_TEMPLATE_SPLIT);y=[q.MO_TEMPLATE_NAME].concat(y)}else{if(y.length==3){B=y[0]+"/"+y[1]+q.MO_TEMPLATE_SPLIT+y[2]}}}D=q.MO_APP+"Views/"+B+"."+q.MO_TEMPLATE_PERX;if(B.indexOf("@")>0){D=q.MO_ROOT+B.substr(B.indexOf("@")+1)+"/Views/"+B.substr(0,B.indexOf("@"))+"."+q.MO_TEMPLATE_PERX}if(!IO.file.exists(D)){D=q.MO_CORE+"Views/"+B+"."+q.MO_TEMPLATE_PERX}if(!IO.file.exists(D)){ExceptionManager.put(25344,"_LoadTemplate()","模板["+C+"]不存在",E_NOTICE);return""}var E=IO.file.readAllText(F.mappath(D),q.MO_CHARSET);if(G){if(!View){View=require("lib/view.js")}if(!View){ExceptionManager.put(77535,"_LoadTemplate()","模板解析器加载失败！");return""}E=View.perCombine(E)}var A=new RegExp('<include file\\=\\"(.+?)(\\.'+q.MO_TEMPLATE_PERX+')?\\" />',"igm");var z=F.string.matches(E,A,function(I,H){c=u(y,H.split(":"));E=F.replace(E,I,b(c.join(":")))});return E};var h=function(y){var z,c;z=y.split(":");if(z.length==1){c=q.MO_TEMPLATE_NAME+"/"+k.Method+q.MO_TEMPLATE_SPLIT+y}else{if(z.length==2){c=q.MO_TEMPLATE_NAME+"/"+y.replace(":",q.MO_TEMPLATE_SPLIT)}else{if(z.length==3){c=z[0]+"/"+z[1]+q.MO_TEMPLATE_SPLIT+z[2]}}}return c};var i=function(c){res.Write(c);res.End()};var p=function(c){return new Function(c)};var r=function(c){return(new Function("__filename","__dirname",IO.file.readAllScript(c)))(c,IO.parent(c))};var l=function(D,c){var B=q.MO_APP_NAME+"@"+c,z=c+"Controller";if(l._controllers.hasOwnProperty(B)){return l._controllers[B]}try{D=F.mappath(D);var y=IO.file.readAllScript(D,q.MO_CHARSET);if(q.MO_DEBUG){y=ReCompileForDebug(y)}y="var "+z+";\r\n"+y+"\r\n return "+z+";";var C=(new Function("__filename","__dirname","M","C","L","__scripts",y))(D,D==""?"":D.substr(0,D.lastIndexOf("\\")),Model__,k.C,k.L,q.MO_DEBUG?y:"");if(C){return C&&(l._controllers[B]=C)}ExceptionManager.put(33536,"_LoadController()","加载控制器时出现错误，请检查是否已经定义相关控制器'"+c+"'。")}catch(A){ExceptionManager.put(A.number,"_LoadController()",'加载控制器"'+c+'"时出现错误:'+A.description)}return false};l._controllers={};var a=function(z){var B=q.MO_APP_NAME+"@"+z;if(a.assets.hasOwnProperty(B)){return new a.assets[B]()}var C=F.mappath(q.MO_APP+"Library/Assets/"+z+".asp");if(!IO.file.exists(C)){C=F.mappath(q.MO_CORE+"Library/Assets/"+z+".asp")}if(!IO.file.exists(C)){return false}var y=IO.file.readAllScript(C,q.MO_CHARSET);y="var "+z+";\r\n"+y+"\r\n return "+z+";";try{var c=(new Function("__filename","__dirname","M","C","L",y))(C,C==""?"":C.substr(0,C.lastIndexOf("\\")),Model__,k.C,k.L);return c&&(new (a.assets[B]=c)());ExceptionManager.put(33536,"_LoadAssets()",'加载asset["'+z+'"]时出现错误，请检查是否已经定义相关Class')}catch(A){ExceptionManager.put(A.number,"_LoadAssets()",'加载asset["'+z+'"]时出现错误:'+A.description)}return false};a.assets={};var f=function(y,A){A=A||"Conf";var z=A+y+"@"+q.MO_APP_NAME;if(f.configs.hasOwnProperty(z)){return f.configs[z]}var B=F.mappath(q.MO_APP+A+"/"+y+".asp");if(!IO.file.exists(B)){B=F.mappath(q.MO_CORE+A+"/"+y+".asp")}if(!IO.file.exists(B)){return null}var c=null;if(c=r(B)){f.configs[z]=c;return c}return null};f.configs={};var t=function(){if(q.MO_PRE_LIB!=""){var z=q.MO_PRE_LIB.split(",");for(var c=0;c<z.length;c++){var y=a(z[c]);if(y){y.Index();y.__destruct()}}}};var j=function(){if(q.MO_END_LIB!=""){var z=q.MO_END_LIB.split(",");for(var c=0;c<z.length;c++){var y=a(z[c]);if(y){y.Index();y.__destruct()}}}};var e={start:0,run:function(){e.start=new Date();return e.start},ticks:function(c){return(new Date())-(c||e.start)},line:0,debugLine:0,scripts:"",file:"",log:function(z,A,y,c){e.line=z;e.file=A;e.debugLine=y;if(c){e.scripts=c}},timelines:{initialize:0,route:0,run:0,load:0,compile:0,run1:0,recompile:0}};var d=function(){if(F.server("HTTP_X_REQUESTED_WITH").toLowerCase()=="xmlhttprequest"){if(E_ERROR&ExceptionManager.errorReporting()){ExceptionManager.errorReporting(E_ERROR)}}if(q.MO_DEBUG){ExceptionManager.put(0,"MO","当前系统开启了DEBUG模式，正式上线后请关闭MO_DEBUG选项，并通过ERROR_REPORTING来显示指定级别异常。",E_NOTICE)}if(!q.MO_COMPILE_CACHE){ExceptionManager.put(0,"MO","当前系统未开启编译缓存，建议正式上线后开启编译缓存(MO_COMPILE_CACHE设置为true)。",E_NOTICE)}ExceptionManager.put(0,"MO",F.format("系统运行时间：{7}MS；其中，系统初始化时间：{0}MS；路由时间：{1}；控制器运行时间：{2}MS（控制器加载时间：{3}MS，模板编译时间：{4}MS，debug再编译时间：{5}MS，已编译模板运行时间：{6}MS）。",e.timelines.initialize,e.timelines.route,e.timelines.run,e.timelines.load,e.timelines.compile,e.timelines.recompile,e.timelines.run1,e.timelines.initialize+e.timelines.route+e.timelines.run),E_INFO);if(Model__&&Model__.debug){Model__.debug()}if(q.MO_DEBUG2FILE){ExceptionManager.debug2file()}else{F.echo(ExceptionManager.debug())}};var x=function(z){var c=z.toString().replace(/^function(.*?)\((.*?)\)([\s\S]+)$/,"$2").replace(/\s/igm,"").split(",");for(var y=0;y<c.length;y++){c[y]=F.get(c[y])}return c};var m=function(c){var y=String(req.ServerVariables("URL"));if(c.MO_APP_NAME==""){i("未定义应用名称：MO_APP_NAME，请检查初始配置参数。")}if(c.MO_ROOT==""){c.MO_ROOT=y.substr(0,y.lastIndexOf("/")+1)}if(c.MO_APP==""){c.MO_APP=c.MO_ROOT+c.MO_APP_NAME+"/"}if(c.MO_CORE==""){c.MO_CORE=c.MO_ROOT+"Mo/"}if(c.MO_APP.slice(-1)!="/"){c.MO_APP=c.MO_APP+"/"}if(c.MO_CORE.slice(-1)!="/"){c.MO_CORE=c.MO_CORE+"/"}if(!IO.directory.exists(c.MO_CORE)){i("核心目录["+c.MO_CORE+"]不存在，请检查初始配置参数。")}if(c.MO_APP_ENTRY==""){c.MO_APP_ENTRY=y.substr(y.lastIndexOf("/")+1);if(c.MO_APP_ENTRY.toLowerCase()=="default.asp"){c.MO_APP_ENTRY=""}}};var k=function(y){if(typeof y=="string"){return n[y]}y=g({},defaultConfig);var c=e.run();if(!k.Initialize(y)){k.Terminate();return}e.timelines.initialize=e.ticks(c);c=e.run();if(q.MO_ROUTE_CONF){k.Route()}e.timelines.route=e.ticks(c);c=e.run();k.Run();e.timelines.run=e.ticks(c);k.Terminate()},q={};k.Runtime=e;k.Version="MoAspEnginer 3.0";k.Config={};k.IsRewrite=false;k.Action="";k.Method="";k.Group="";k.RealAction="";k.RealMethod="";k.Status="";k.Buffer=false;k.LoadAssets=a;k.Debug=function(){e.log.apply(null,arguments)};k.Initialize=function(y){if(!y||typeof y!="object"){y={MO_AUTO_CREATE_APP:false}}y=g({MO_APP_NAME:"App",MO_APP:"App",MO_APP_ENTRY:"",MO_ROOT:"",MO_CORE:"Mo",MO_HOST:String(req.ServerVariables("HTTP_HOST")),MO_PROTOCOL:String(req.ServerVariables("HTTPS"))=="off"?"http://":"https://"},y);res.Charset="utf-8";k.Config.Global=y;k.Status="200 OK";var c=e.run();m(y);if(IO.file.exists(y.MO_CORE+"Conf/Config.asp")){q=k.Config.Global=p(IO.file.readAllScript(y.MO_CORE+"Conf/Config.asp"))()}g(q,y);IO.directory.files(q.MO_CORE+"Common",function(B){if(B.name.slice(-4)==".asp"){r(B.path)}});require=p(IO.file.readAllText(y.MO_CORE+"Library/Extend/lib/require.js"))();require.module._pathes=[v(q.MO_APP+"Library/Extend"),v(q.MO_CORE+"Library/Extend")];F=require("lib/fns.js");if(!F){ExceptionManager.put(136159,"F","fns模块加载异常，系统将不可用。",E_ERROR);return}IO=require("lib/io.js");if(!IO){ExceptionManager.put(136159,"IO","IO模块加载异常，系统将不可用。",E_ERROR);return}if(q.MO_AUTO_CREATE_APP!==false&&!IO.directory.exists(q.MO_APP)){F.foreach(["","Controllers","Cache/Compiled","Cache/Model","Views","Conf","Lang","Library/Extend","Library/Assets","Common"],function(C,B){IO.directory.create(q.MO_APP+B)})}require(v(q.MO_APP+"Conf/Config.asp"),true,function(){if(this.hasOwnProperty("MO_LIB_CNAMES")){if(this.MO_LIB_CNAMES){g(q.MO_LIB_CNAMES,this.MO_LIB_CNAMES)}delete this.MO_LIB_CNAMES}for(var B in y){delete this[B]}g(q,this)});if(!q.MO_METHOD_CHAR){q.MO_METHOD_CHAR="m"}if(!q.MO_ACTION_CHAR){q.MO_ACTION_CHAR="a"}if(!q.MO_GROUP_CHAR){q.MO_GROUP_CHAR="g"}ExceptionManager.errorReporting(q.MO_ERROR_REPORTING);if(q.MO_CHARSET!="utf-8"){res.Charset=q.MO_CHARSET}if(IO.file.exists(q.MO_APP+"Common/Function.asp")){r(q.MO_APP+"Common/Function.asp")}if(q.MO_IMPORT_COMMON_FILES!=""){var A=q.MO_IMPORT_COMMON_FILES.split(";");if(A.length<=0){return}for(var z=0;z<A.length;z++){if(!A[z]){continue}r(q.MO_APP+"Common/"+A[z]+".asp")}}t();k.assign("VERSION",k.Version);return true};k.Terminate=function(){j();if(Model__&&Model__.dispose){Model__.dispose()}F.dispose();d();n=null;this.Config=null;w=null};function s(c){var y=/^(.+?)(\?(.+))?$/.exec(c);if(y){var z=u(["","",""],y[1].split("/"));F.get(q.MO_GROUP_CHAR,z[0]);F.get(q.MO_METHOD_CHAR,z[1]);F.get(q.MO_ACTION_CHAR,z[2]);F.get.fromURIString(y[3])}}k.Route=function(){var C=req.QueryString+"",y="";var E=/^404\;http(s)?\:\/\/(.+?)\/(.*?)$/i.exec(C);if(E!=null){q.MO_ROUTE_MODE="404";k.IsRewrite=true;y="/"+E[3]}if(q.MO_ROUTE_MODE=="404"){if(F.server("HTTP_X_REWRITE_URL")!=""){y=F.server("HTTP_X_REWRITE_URL")}}else{if(q.MO_ROUTE_MODE=="URL"){y=C;k.IsRewrite=true;if(y==""){return}}else{return}}if(q.MO_ROOT!="/"&&y.substr(0,q.MO_ROOT.length)==q.MO_ROOT){y=y.substr(q.MO_ROOT.length-1)}if(q.MO_ROUTE_URL_EXT){y=y.replace(new RegExp("\\."+q.MO_ROUTE_URL_EXT+"$","i"),"");if(y.slice(0,1)=="/"){y=y.substr(1)}if(y.slice(-1)=="/"){y=y.substr(0,v.length-1)}}if(!y){return}var c=q.MO_ROUTE_MAPS;if(c&&c.hasOwnProperty(y)){s(c[y]);return}var A=F.server("REQUEST_METHOD"),G=q.MO_ROUTE_REST_ENABLED;var B=q.MO_ROUTE_RULES;for(var z=0;z<B.length;z++){var D=B[z];if(!D.Method){D.Method="GET"}if(D.LookFor.test(y)&&(!G||A==D.Method)){RouteTo=y.replace(D.LookFor,D.SendTo);break}}if(RouteTo){s(RouteTo)}};k.display=function(c,y){res.Status=this.Status;res.AddHeader("Content-Type","text/html; charset="+q.MO_CHARSET);k.fetch(c,y)};k.fetch=function(L,I){k.Buffer=!(arguments.callee.caller==k.display);var B=e.run();if(!L||L==""){L=k.Action}var H,C,A,D=false,E,z="";if(q.MO_COMPILE_CACHE){C=k.Method+"^"+k.Action+"^"+F.string.replace(L,/\:/igm,"^");if(I){C+="^"+I}z=F.mappath(q.MO_APP+"Cache/Compiled/"+C+".asp");if(IO.file.exists(z)){D=true;if(q.MO_COMPILE_CACHE_EXPIRED>0){A=F.fso.GetFile(z).DateLastModified;if(F.date.datediff("s",A,new Date())>=q.MO_COMPILE_CACHE_EXPIRED){D=false}}if(D){E=IO.file.readAllScript(z,q.MO_CHARSET)}}}if(!D){H=b(L,false);if(H==""){return""}if(!View){View=require("lib/view.js")}if(!View){ExceptionManager.put(77535,"Mo.fetch()","模板解析器加载失败！");return""}var G=new View();E=G.setContent(H).parse().Content;if(q.MO_COMPILE_CACHE){IO.file.writeAllText(z,'\u003cscript language="jscript" runat="server"\u003e\r\n'+E+"\r\n\u003c/script\u003e",q.MO_CHARSET)}}e.timelines.compile=e.ticks(B);if(q.MO_DEBUG){B=e.run();E=ReCompileForDebug(E,-1);e.timelines.recompile=e.ticks(B)}B=e.run();var y,J;try{y=new Function("$","__filename","__scripts","__buffer","__buffersize",E)}catch(K){ExceptionManager.put(K.number,"Mo.fetch()","已编译的模板代码包装错误："+K.description,E_ERROR);return}var c=z;if(q.MO_DEBUG){c+=";由模板["+h(L)+"."+q.MO_TEMPLATE_PERX+"]编译，请检查模板是否有语法错误或使用了未声明的变量。"}J=y(n,c,q.MO_DEBUG?E:"",k.Buffer,1024);if(q.MO_CACHE&&q.MO_CACHE_DIR!=""&&IO.directory.exists(q.MO_CACHE_DIR)){IO.file.writeAllText(F.mappath(q.MO_CACHE_DIR+o+".cache"),J,q.MO_CHARSET)}e.timelines.run1=e.ticks(B);return J};k.U=function(G,H,y){var B=/^(.*?)(\?(.*?))?(\#(.*?))?(\@(.*?))?(\!)?$/igm.exec(G||"");if(!B){return""}F.object.toURIString.fn=0;var G=B[1],D=F.object.fromURIString(B[3]),A=B[5],z=B[7],E=G.split("/"),c=q.MO_PROTOCOL+(z||q.MO_HOST)+q.MO_ROOT+q.MO_APP_ENTRY;if(H){if(typeof H=="string"){D=F.object.fromURIString(H)}else{if(typeof H=="object"){D=H}}}if(B[8]=="!"){c=q.MO_ROOT+q.MO_APP_ENTRY}var C=["?{0}={1}&{2}={3}&{4}={5}","?{0}={1}&{2}={3}"];if(q.MO_ROUTE_MODE=="404"){C=["{1}/{3}/{5}","{1}/{3}"]}else{if(q.MO_ROUTE_MODE=="URL"){C=["?/{1}/{3}/{5}","?/{1}/{3}"]}}if(E.length==3){c+=F.format(C[0],q.MO_GROUP_CHAR,E[0],q.MO_METHOD_CHAR,E[1],q.MO_ACTION_CHAR,E[2])}else{if(E.length==2){c+=F.format(C[1],q.MO_METHOD_CHAR,E[0],q.MO_ACTION_CHAR,E[1])}else{if(E.length==1&&G!=""){c+=F.format(C[1],q.MO_METHOD_CHAR,k.Method,q.MO_ACTION_CHAR,E[0])}else{c+=F.format(C[1],q.MO_METHOD_CHAR,k.Method,q.MO_ACTION_CHAR,k.Action)}}}if(q.MO_ROUTE_MODE=="404"||q.MO_ROUTE_MODE=="URL"){F.object.toURIString.split_char_1=F.object.toURIString.split_char_2="/";c+="/"+F.object.toURIString(D);F.object.toURIString.split_char_1="=";F.object.toURIString.split_char_2="&";if(y){c+="."+y}}else{c+="&"+F.object.toURIString(D)}if(F.string.endsWith(c,"/")||F.string.endsWith(c,"&")){c=c.substr(0,c.length-1)}if(A!=""){c+="#"+A}F.object.toURIString.fn=1;return c};k.L=function(y){if(!q.MO_LANGUAGE){ExceptionManager.put(5,"Mo.L(key)","未定义语言包");return""}var z=q.MO_LANGUAGE;if(y.indexOf(".")>0){z=y.substr(0,y.indexOf("."));y=y.substr(y.indexOf(".")+1)}var c=null;if(c=f(z,"Lang")){return c[y]}else{ExceptionManager.put(3,"Mo.L(key)","语言包["+z+"]无法加载,请检查语言包是否存在及正确")}};k.C=function(y,A){var z="";if(y.indexOf(".")>0){z=y.substr(y.indexOf(".")+1);y=y.substr(0,y.indexOf("."));if(y=="@"){y="Global"}}if(k.Config.hasOwnProperty(y)){if(z!=""&&A!==undefined){k.Config[y][z]=A}return(z==""?k.Config[y]:k.Config[y][z])}var c=null;if(c=f(y)){k.Config[y]=c;if(z!=""&&A!==undefined){k.Config[y][z]=A}return(z==""?k.Config[y]:k.Config[y][z])}else{ExceptionManager.put(3,"Mo.C(conf,value)","配置["+y+"]无法加载,请检查配置文件是否存在以及正确")}};k.C.SaveAs=function(c,z){if(!z){return}var y=F.mappath(q.MO_APP+"Conf/"+c+".asp");IO.file.writeAllText(y,'\u003cscript language="jscript" runat="server"\u003e\r\nreturn '+JSON.stringify(z)+";\r\n\u003c/script\u003e","utf-8")};k.C.Exists=function(c){return IO.file.exists(q.MO_APP+"Conf/"+c+".asp")};k.A=function(y){var c=F.mappath(q.MO_APP+"Controllers/"+y+"Controller.asp");if(!IO.file.exists(c)){c=F.mappath(q.MO_CORE+"Controllers/"+y+"Controller.asp")}if(IO.file.exists(c)){var z;if(q.MO_CONTROLLER_CNAMES&&q.MO_CONTROLLER_CNAMES.hasOwnProperty(y.toLowerCase())){y=q.MO_CONTROLLER_CNAMES[y.toLowerCase()]}if(z=l(c,y)){return new z()}else{ExceptionManager.put(5,"Mo.A(ctrl)","模块["+y+"]无法加载,请检查模块文件")}}else{ExceptionManager.put(6,"Mo.A(ctrl)","模块["+y+"]无法加载,请检查模块文件是否存在")}};k.Run=function(){var y=e.run();this.Method=F.get(q.MO_METHOD_CHAR);this.Action=F.get(q.MO_ACTION_CHAR);this.Group=F.get(q.MO_GROUP_CHAR);if(!/^(\w+)$/i.test(this.Action)){this.Action="Index"}if(!/^(\w+)$/i.test(this.Method)){this.Method="Home"}if(!/^(\w+)$/i.test(this.Group)){this.Group=""}if(this.Group!=""){this.Group+="/"}if(q.MO_CONTROLLER_CNAMES&&q.MO_CONTROLLER_CNAMES.hasOwnProperty(this.Method.toLowerCase())){this.Method=q.MO_CONTROLLER_CNAMES[this.Method.toLowerCase()]}if(q.MO_CACHE){o=MD5(F.server("URL")+F.get.toURIString()+"");if(IO.file.exists(q.MO_CACHE_DIR+o+".cache")){res.Write(IO.file.readAllText(F.mappath(q.MO_CACHE_DIR+o+".cache"),q.MO_CHARSET));return}}var C=q.MO_APP+"Controllers/"+this.Group+this.Method+"Controller.asp",B=true;this.RealMethod=this.Method;this.RealAction=this.Action;if(!IO.file.exists(C)){C=q.MO_APP+"Controllers/"+this.Group+"EmptyController.asp";this.RealMethod="Empty";if(!IO.file.exists(C)){C=q.MO_CORE+"Controllers/"+this.Group+this.Method+"Controller.asp";this.RealMethod=this.Method;if(!IO.file.exists(C)){C=q.MO_CORE+"Controllers/"+this.Group+"EmptyController.asp";this.RealMethod="Empty";if(!IO.file.exists(C)){if(k.templateIsInApp(this.Action)||k.templateIsInCore(this.Action)){k.display(this.Action);B=false}else{ExceptionManager.put(11772,this.RealMethod+"."+this.RealAction,"模块["+this.Method+"]不存在");return}}}}}var D;if(!(B&&(D=l(C,this.RealMethod)))){return}if(D.__PRIVATE__===true){ExceptionManager.put(11772,this.RealMethod+"."+this.RealAction,"模块["+this.Method+"]不存在");return}e.timelines.load=e.ticks(y);var A=new D(this.Action);if(A.__STATUS__===true){var z=this.Action;if(q.MO_ACTION_CASE_SENSITIVITY===false){z=z.toLowerCase()}var H=null,G=[],I=A;if(F.server("REQUEST_METHOD")=="POST"&&A[z+"_Post_"]&&A[z+"_Post_"]["__PRIVATE__"]!==true){H=A[z+"_Post_"]}else{if(A[z]&&A[z]["__PRIVATE__"]!==true){H=A[z]}else{if(q.MO_AUTO_DISPLAY&&(k.templateIsInApp(this.Action)||k.templateIsInCore(this.Action))){I=k;H=k.display;G=[this.Action]}else{if(A.empty&&A.empty["__PRIVATE__"]!==true){k.RealAction="empty";H=A.empty;G=[this.Action]}else{ExceptionManager.put(936,this.RealMethod+"."+this.RealAction,"未定义相应"+this.Action+"或empty方法。")}}}}if(q.MO_PARSEACTIONPARMS===true){G=x(H)}try{H&&H.apply(I,G)}catch(E){var c=new Exception(E.number,this.RealMethod+"."+this.RealAction,E.description);if(e.line>0){c.lineNumber=e.line;c.filename=e.file.replace(F.mappath("/"),"").replace(/\\/ig,"/");if(e.debugLine>0&&e.scripts!=""){c.traceCode=e.scripts.split("\n")[e.debugLine]}}ExceptionManager.put(c)}}A.__destruct();A=null};k.ModelCacheExists=function(c){if(c==""){return false}return F.exists(q.MO_APP+"Cache/Model/"+c+".cak")};k.ModelCacheSave=function(c,y){if(c==""){return false}return IO.file.writeAllText(F.mappath(q.MO_APP+"Cache/Model/"+c+".cak"),y,q.MO_CHARSET)};k.ModelCacheLoad=function(c){if(c==""){return""}return IO.file.readAllText(F.mappath(q.MO_APP+"Cache/Model/"+c+".cak"),q.MO_CHARSET)};k.ModelCacheDelete=function(c){if(c==""){return false}return IO.file.del(F.mappath(q.MO_APP+"Cache/Model/"+c+".cak"))};k.ModelCacheClear=function(){return IO.directory.clear(F.mappath(q.MO_APP+"Cache/Model"),function(c,y){if(y&&c.name==".mae"){return false}})};k.ClearCompiledCache=function(){return IO.directory.clear(F.mappath(q.MO_APP+"Cache/Compiled"),function(c,y){if(y&&c.name==".mae"){return false}})};k.templateIsInApp=function(y){var c=h(y),z;z=q.MO_APP+"Views/"+c+"."+q.MO_TEMPLATE_PERX;if(c.indexOf("@")>0){z=q.MO_ROOT+c.substr(c.indexOf("@")+1)+"/Views/"+c.substr(0,c.indexOf("@"))+"."+q.MO_TEMPLATE_PERX}return IO.file.exists(z)};k.templateIsInCore=function(y){var c,z;c=h(y);z=q.MO_CORE+"Views/"+c+"."+q.MO_TEMPLATE_PERX;return IO.file.exists(z)};k.assign=function(c,y){if(!/^(\w+)$/ig.test(c)){return ExceptionManager.put(11852,"Mo.assign","Parameter 'key' is invalid.")}n[c]=y};return k})();(function(){var e={base64:["e","d","encode","decode","toBinary","fromBinary","base64"],JSON:["parse","stringify","create","assets/json.js"],IController:["create","IController@lib/dist.js"],IClass:["create","IClass@lib/dist.js"],dump:[null,"dump"],"cookie=Cookie":[null,"assets/cookie.js"],Model__:[null,"useCommand","Debug","setDefault","setDefaultPK","begin","commit","rollback","getConnection","dispose","connect","execute","executeQuery","Model__@lib/model.js"],DataTable:[null,"Model__.helper.DataTable@lib/model.js"],DataTableRow:[null,"Model__.helper.DataTableRow@lib/model.js"],VBS:["ns","include","eval","require","getref","execute","run","assets/vbs.js"],Mpi:["downloadAndInstall","Host","setDefaultInstallDirectory","download","fetchPackagesList","fetchPackage","packageExists","install","assets/mpi.js"],Tar:[null,"packFolder","packFile","unpack","assets/tar.js"],"md5=MD5":[null,"md5@assets/md5.js"],"md5_bytes=MD5Bytes":[null,"md5_bytes@assets/md5.js"]};var m=Mo.Runtime.run();for(var k in e){if(!e.hasOwnProperty(k)){continue}var l=e[k],b=l.pop(),h=b.indexOf("@"),c="",f="",j=k.indexOf("=");if(h>0){c="."+b.substr(0,h);b=b.substr(h+1)}(new Function(k+" = {};"))();if(j>0){f=k.substr(j+1);k=k.substr(0,j)}for(var d=0;d<l.length;d++){var a="."+l[d];if(l[d]==null){a=""}var g=k+a+" = function(){"+k+' = require("'+b+'")'+c+"; return "+k+a+".apply("+k+",arguments)};";(new Function(g))()}if(f){(new Function(f+" = "+k+";"))()}}})();var Encapsulate=Function.Create=function(a){var c=[];for(var d=0;d<a;d++){c.push("arg"+d)}var b=c.join(",");return new Function(b,"return new this("+b+");")};var E_NONE=0,E_ERROR=1,E_NOTICE=2,E_WARNING=4,E_INFO=8,E_ALL=E_ERROR|E_NOTICE|E_WARNING|E_INFO;var ExceptionManager=(function(){var e={};var l=[],k=E_ALL,g={1:"red",2:"orange",4:"blue",8:"green"};var f=function(b){var a="0000000"+b.toString(16).toUpperCase();return a.substr(a.length-8)};function i(a){return a==1?"E_ERROR":(a==2?"E_NOTICE":(a==4?"E_WARNING":"E_INFO"))}e.put=function(){var b=Array.prototype.slice.call(arguments,0),a=E_ERROR;if(typeof b[b.length-1]=="number"){a=b.pop()}if(b.length==1){if(b[0].constructor==Exception){l.push(b[0])}else{l.push(new Exception(b[0].number,"Microsoft.JScriptError",b[0].description,a))}}else{if(b.length==2){l.push(new Exception(b[0].number,b[1],b[0].description,a))}else{if(b.length==3){l.push(new Exception(b[0],b[1],b[2],a))}}}};e.putNotice=function(){var a=Array.prototype.slice.call(arguments,0);a.push(E_NOTICE);e.put.apply(null,a)};e.putWarning=function(b){var a=Array.prototype.slice.call(arguments,0);a.push(E_WARNING);e.put.apply(null,a)};e.errorReporting=function(a){if(arguments.length==0){return k}k=a};e.clear=function(){while(l.length>0){l.pop()}};e.debug=function(){if(l.length==0){return""}var a="";for(var b=0;b<l.length;b++){var c=l[b];if(c.level&k){a+=F.format('[<b>0x{0:X8}</b>] <span style="color:'+g[c.level]+'">{1}：{2} [{3}]</span>\r\n',c.Number,c.Source,F.encodeHtml(c.Description),i(c.level));if(c.filename){a+="  文件："+c.filename+"\r\n"}if(c.lineNumber>0){a+="  行号："+c.lineNumber+"\r\n"}if(c.traceCode){a+='  源码：<span style="color:red">'+c.traceCode+"</span>\r\n"}}}if(a==""){return""}return"<pre style=\"font-family:'Courier New';font-size:12px; padding:8px; background-color:#f6f6f6;border:1px #ddd solid;border-radius:5px;line-height:18px;\">"+a+"</pre>"};e.debug2file=function(){if(l.length==0){return""}var a="";for(var b=0;b<l.length;b++){var c=l[b];if(c.level&k){a+=F.format("{0}：{1} [{2}]\r\n",c.Source,F.encodeHtml(c.Description),i(c.level));if(c.filename){a+="  文件："+c.filename+"\r\n"}if(c.lineNumber>0){a+="  行号："+c.lineNumber+"\r\n"}if(c.traceCode){a+="  源码："+c.traceCode+"\r\n"}}}if(a==""){return}if(Mo.Config.Global.MO_DEBUG_FILE){IO.file.appendAllText(Mo.Config.Global.MO_DEBUG_FILE,a+"\r\n")}};return e})();function Exception(e,h,f,g){this.level=g||E_ERROR;this.levelString="E_ERROR";this.Number=e||0;if(this.Number<0){this.Number=this.Number+4294967296}this.Source=h||"";this.Message=f||"";this.Description=f||"";this.lineNumber=0;this.filename="";this.traceCode=""}var IO=(function(){var f=function(a){if(typeof a!="string"){return""}if(a.substr(1,1)==":"){return a}return Server.MapPath(a)};var e=function(b,c){for(var a in c){if(c.hasOwnProperty(a)){b[a]=c[a]}}return b};var d=(function(){var a={};a.resolve=f;a.is=function(b){if(b.length<2){return false}return b.substr(1,1)==":"};a.fso=new ActiveXObject("scripting.filesystemobject");a.parent=function(b){return a.fso.GetParentFolderName(f(b))};a.absolute=function(b){return a.fso.GetAbsolutePathName(f(b))};a.base=function(b){return a.fso.GetBaseName(f(b))};a.parent=function(b){return a.fso.GetParentFolderName(f(b))};a.build=function(c,b){return a.fso.GetAbsolutePathName(a.fso.BuildPath(f(c),b))};a.stream=function(b,h){var c=new ActiveXObject("adodb.stream");c.mode=b||3;c.type=h||1;return c};a.fps=[];return a})();d.file=d.file||(function(){var a={};a.exists=function(b){b=f(b);return d.fso.fileexists(b)};a.readAllText=function(b,c){return(function(j){var i=d.file.read(j);d.file.close(j);return i})(d.file.open(b,{forText:true,forRead:true,encoding:c||"utf-8"}))};a.readAllScript=function(b,c){var h=(function(j){var g=d.file.read(j);d.file.close(j);return g})(d.file.open(b,{forText:true,forRead:true,encoding:c||"utf-8"}));h=h.replace(new RegExp("^(\\s*)\\u003cscript(.+?)\\u003e(\\s*)","i"),"").replace(new RegExp("(\\s*)\\u003c\\/script\\u003e(\\s*)$","i"),"");return h};a.open=function(b,c){b=f(b);var j={forAppend:false,forText:true,forRead:false,encoding:"utf-8"};e(j,c||{});var i=d.stream(3,j.forText?2:1);if(j.forText){i.charset=j.encoding}i.open();if(a.exists(b)&&(j.forAppend||j.forRead)){i.loadfromfile(b);if(j.forAppend){i.position=i.size}}d.fps.push([i,b,j]);return d.fps.length-1};a.read=function(c,b){if(!d.fps[c]){ExceptionManager.put(11598,"io.file.read","file resource id is invalid.");return null}if(d.fps[c][2].forText){if(b){return d.fps[c][0].readText(b)}return d.fps[c][0].readText()}else{if(b){return d.fps[c][0].read(b)}return d.fps[c][0].read()}};a.close=function(b){if(!d.fps[b]){ExceptionManager.put(11630,"io.file.close","file resource id is invalid.");return}d.fps[b][0].close()};return a})();d.directory=d.directory||(function(){var a={};a.exists=function(b){return d.fso.folderexists(f(b))};a.files=function(h,i){if(!a.exists(h)){return[]}var c=[];var b=new Enumerator(d.fso.getFolder(f(h)).files);var g=(typeof i=="function");for(;!b.atEnd();b.moveNext()){if(g){i(b.item())}else{c.push(b.item().path)}}return c};return a})();return d})();