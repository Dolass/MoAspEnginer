var defaultConfig={},define=function(a,b){defaultConfig[a.toUpperCase()]=b};var F,JSON,require,VBS,View,Model__,req=Request,res=Response,ROOT=Server.Mappath("/"),Mo,startup=Mo=Mo||(function(){var w=function(c){if(typeof c!="string"){return""}if(c.substr(1,1)==":"){return c}return Server.MapPath(c)};var p="",o={},x={};var g=function(A,z){for(var B in z){if(z.hasOwnProperty(B)){A[B]=z[B]}}return A};var v=function(A,z){var c=0;while(true){if(c>=A.length||c>=z.length){break}A[A.length-c-1]=z[z.length-c-1];c++}return A};var b=function(D,H){var z,C,E,c;H=!!H;z=D.split(":");if(z.length==1){C=r.MO_TEMPLATE_NAME+"/"+l.Method+r.MO_TEMPLATE_SPLIT+D;z=[r.MO_TEMPLATE_NAME,l.Method,D]}else{if(z.length==2){C=r.MO_TEMPLATE_NAME+"/"+D.replace(":",r.MO_TEMPLATE_SPLIT);z=[r.MO_TEMPLATE_NAME].concat(z)}else{if(z.length==3){C=z[0]+"/"+z[1]+r.MO_TEMPLATE_SPLIT+z[2]}}}E=r.MO_APP+"Views/"+C+"."+r.MO_TEMPLATE_PERX;if(C.indexOf("@")>0){E=r.MO_ROOT+C.substr(C.indexOf("@")+1)+"/Views/"+C.substr(0,C.indexOf("@"))+"."+r.MO_TEMPLATE_PERX}if(!IO.file.exists(E)){E=r.MO_CORE+"Views/"+C+"."+r.MO_TEMPLATE_PERX}if(!IO.file.exists(E)){ExceptionManager.put(25344,"_LoadTemplate()","模板["+D+"]不存在",E_NOTICE);return""}var G=IO.file.readAllText(F.mappath(E),r.MO_CHARSET);if(H){if(!View){View=require("lib/view.js")}if(!View){ExceptionManager.put(77535,"_LoadTemplate()","模板解析器加载失败！");return""}G=View.perCombine(G)}var B=new RegExp('<include file\\=\\"(.+?)(\\.'+r.MO_TEMPLATE_PERX+')?\\" />',"igm");var A=F.string.matches(G,B,function(J,I){c=v(z,I.split(":"));G=F.replace(G,J,b(c.join(":")))});return G};var h=function(z){var A,c;A=z.split(":");if(A.length==1){c=r.MO_TEMPLATE_NAME+"/"+l.Method+r.MO_TEMPLATE_SPLIT+z}else{if(A.length==2){c=r.MO_TEMPLATE_NAME+"/"+z.replace(":",r.MO_TEMPLATE_SPLIT)}else{if(A.length==3){c=A[0]+"/"+A[1]+r.MO_TEMPLATE_SPLIT+A[2]}}}return c};var j=function(c){res.Write(c);res.End()};var q=function(c){return new Function(c)};var i=function(z){var c={exports:{}};(new Function("exports","module",z))(c.exports,c);return c.exports};var s=function(c){return(new Function("__filename","__dirname",IO.file.readAllScript(c)))(c,IO.parent(c))};var m=function(E,c){var C=r.MO_APP_NAME+"@"+c,A=c+"Controller";if(m._controllers.hasOwnProperty(C)){return m._controllers[C]}try{E=F.mappath(E);var z=IO.file.readAllScript(E,r.MO_CHARSET);if(r.MO_DEBUG){z=ReCompileForDebug(z)}z="var "+A+";\r\n"+z+"\r\n return "+A+";";var D=(new Function("__filename","__dirname","M","C","L","__scripts",z))(E,E==""?"":E.substr(0,E.lastIndexOf("\\")),Model__,l.C,l.L,r.MO_DEBUG?z:"");if(D){return D&&(m._controllers[C]=D)}ExceptionManager.put(33536,"_LoadController()","加载控制器时出现错误，请检查是否已经定义相关控制器'"+c+"'。")}catch(B){ExceptionManager.put(B.number,"_LoadController()",'加载控制器"'+c+'"时出现错误:'+B.description)}return false};m._controllers={};var a=function(A){var C=r.MO_APP_NAME+"@"+A;if(a.assets.hasOwnProperty(C)){return new a.assets[C]()}var D=F.mappath(r.MO_APP+"Library/Assets/"+A+".asp");if(!IO.file.exists(D)){D=F.mappath(r.MO_CORE+"Library/Assets/"+A+".asp")}if(!IO.file.exists(D)){return false}var z=IO.file.readAllScript(D,r.MO_CHARSET);z="var "+A+";\r\n"+z+"\r\n return "+A+";";try{var c=(new Function("__filename","__dirname","M","C","L",z))(D,D==""?"":D.substr(0,D.lastIndexOf("\\")),Model__,l.C,l.L);return c&&(new (a.assets[C]=c)());ExceptionManager.put(33536,"_LoadAssets()",'加载asset["'+A+'"]时出现错误，请检查是否已经定义相关Class')}catch(B){ExceptionManager.put(B.number,"_LoadAssets()",'加载asset["'+A+'"]时出现错误:'+B.description)}return false};a.assets={};var f=function(z,B){B=B||"Conf";var A=B+z+"@"+r.MO_APP_NAME;if(f.configs.hasOwnProperty(A)){return f.configs[A]}var C=F.mappath(r.MO_APP+B+"/"+z+".asp");if(!IO.file.exists(C)){C=F.mappath(r.MO_CORE+B+"/"+z+".asp")}if(!IO.file.exists(C)){return null}var c=null;if(c=s(C)){f.configs[A]=c;return c}return null};f.configs={};var u=function(){if(r.MO_PRE_LIB!=""){var A=r.MO_PRE_LIB.split(",");for(var c=0;c<A.length;c++){var z=a(A[c]);if(z){z.Index();z.__destruct()}}}};var k=function(){if(r.MO_END_LIB!=""){var A=r.MO_END_LIB.split(",");for(var c=0;c<A.length;c++){var z=a(A[c]);if(z){z.Index();z.__destruct()}}}};var e={start:0,run:function(){e.start=new Date();return e.start},ticks:function(c){return(new Date())-(c||e.start)},line:0,debugLine:0,scripts:"",file:"",log:function(A,B,z,c){e.line=A;e.file=B;e.debugLine=z;if(c){e.scripts=c}},timelines:{initialize:0,route:0,run:0,load:0,compile:0,run1:0,recompile:0}};var d=function(){if(F.server("HTTP_X_REQUESTED_WITH").toLowerCase()=="xmlhttprequest"){if(E_ERROR&ExceptionManager.errorReporting()){ExceptionManager.errorReporting(E_ERROR)}}if(r.MO_DEBUG){ExceptionManager.put(0,"MO","当前系统开启了DEBUG模式，正式上线后请关闭MO_DEBUG选项，并通过ERROR_REPORTING来显示指定级别异常。",E_NOTICE)}if(!r.MO_COMPILE_CACHE){ExceptionManager.put(0,"MO","当前系统未开启编译缓存，建议正式上线后开启编译缓存(MO_COMPILE_CACHE设置为true)。",E_NOTICE)}ExceptionManager.put(0,"MO",F.format("系统运行时间：{7}MS；其中，系统初始化时间：{0}MS；路由时间：{1}；控制器运行时间：{2}MS（控制器加载时间：{3}MS，模板编译时间：{4}MS，debug再编译时间：{5}MS，已编译模板运行时间：{6}MS）。",e.timelines.initialize,e.timelines.route,e.timelines.run,e.timelines.load,e.timelines.compile,e.timelines.recompile,e.timelines.run1,e.timelines.initialize+e.timelines.route+e.timelines.run),E_INFO);if(Model__&&Model__.debug){Model__.debug()}if(r.MO_DEBUG2FILE){ExceptionManager.debug2file()}else{F.echo(ExceptionManager.debug())}};var y=function(A){var c=A.toString().replace(/^function(.*?)\((.*?)\)([\s\S]+)$/,"$2").replace(/\s/igm,"").split(",");for(var z=0;z<c.length;z++){c[z]=F.get(c[z])}return c};var n=function(c){var z=String(req.ServerVariables("URL"));if(c.MO_APP_NAME==""){j("未定义应用名称：MO_APP_NAME，请检查初始配置参数。")}if(c.MO_ROOT==""){c.MO_ROOT=z.substr(0,z.lastIndexOf("/")+1)}if(c.MO_APP==""){c.MO_APP=c.MO_ROOT+c.MO_APP_NAME+"/"}if(c.MO_CORE==""){c.MO_CORE=c.MO_ROOT+"Mo/"}if(c.MO_APP.slice(-1)!="/"){c.MO_APP=c.MO_APP+"/"}if(c.MO_CORE.slice(-1)!="/"){c.MO_CORE=c.MO_CORE+"/"}if(!IO.directory.exists(c.MO_CORE)){j("核心目录["+c.MO_CORE+"]不存在，请检查初始配置参数。")}if(c.MO_APP_ENTRY==""){c.MO_APP_ENTRY=z.substr(z.lastIndexOf("/")+1);if(c.MO_APP_ENTRY.toLowerCase()=="default.asp"){c.MO_APP_ENTRY=""}}};var l=function(z){if(typeof z=="string"){return o[z]}z=g({},defaultConfig);var c=e.run();if(!l.Initialize(z)){l.Terminate();return}e.timelines.initialize=e.ticks(c);c=e.run();if(r.MO_ROUTE_CONF){l.Route()}e.timelines.route=e.ticks(c);c=e.run();l.Run();e.timelines.run=e.ticks(c);l.Terminate()},r={};l.Runtime=e;l.Version="MoAspEnginer 3.0";l.Config={};l.IsRewrite=false;l.Action="";l.Method="";l.Group="";l.RealAction="";l.RealMethod="";l.Status="";l.Buffer=false;l.LoadAssets=a;l.Debug=function(){e.log.apply(null,arguments)};l.Initialize=function(z){if(!z||typeof z!="object"){z={MO_AUTO_CREATE_APP:false}}z=g({MO_APP_NAME:"App",MO_APP:"App",MO_APP_ENTRY:"",MO_ROOT:"",MO_CORE:"Mo",MO_HOST:String(req.ServerVariables("HTTP_HOST")),MO_PROTOCOL:String(req.ServerVariables("HTTPS"))=="off"?"http://":"https://"},z);res.Charset="utf-8";l.Config.Global=z;l.Status="200 OK";var c=e.run();n(z);if(IO.file.exists(z.MO_CORE+"Conf/Config.asp")){r=l.Config.Global=q(IO.file.readAllScript(z.MO_CORE+"Conf/Config.asp"))()}g(r,z);IO.directory.files(r.MO_CORE+"Common",function(C){if(C.name.slice(-4)==".asp"){s(C.path)}});require=i(IO.file.readAllText(z.MO_CORE+"Library/Extend/lib/require.js"));require.module._pathes=[w(r.MO_APP+"Library/Extend"),w(r.MO_CORE+"Library/Extend")];F=require("lib/fns.js");if(!F){ExceptionManager.put(136159,"F","fns模块加载异常，系统将不可用。",E_ERROR);return}IO=require("lib/io.js");if(!IO){ExceptionManager.put(136159,"IO","IO模块加载异常，系统将不可用。",E_ERROR);return}if(r.MO_AUTO_CREATE_APP!==false&&!IO.directory.exists(r.MO_APP)){F.foreach(["","Controllers","Cache/Compiled","Cache/Model","Views","Conf","Lang","Library/Extend","Library/Assets","Common"],function(D,C){IO.directory.create(r.MO_APP+C)})}require(w(r.MO_APP+"Conf/Config.asp"),true,function(){if(this.hasOwnProperty("MO_LIB_CNAMES")){if(this.MO_LIB_CNAMES){g(r.MO_LIB_CNAMES,this.MO_LIB_CNAMES)}delete this.MO_LIB_CNAMES}for(var C in z){delete this[C]}g(r,this)});if(!r.MO_METHOD_CHAR){r.MO_METHOD_CHAR="m"}if(!r.MO_ACTION_CHAR){r.MO_ACTION_CHAR="a"}if(!r.MO_GROUP_CHAR){r.MO_GROUP_CHAR="g"}ExceptionManager.errorReporting(r.MO_ERROR_REPORTING);if(r.MO_CHARSET!="utf-8"){res.Charset=r.MO_CHARSET}if(IO.file.exists(r.MO_APP+"Common/Function.asp")){s(r.MO_APP+"Common/Function.asp")}if(r.MO_IMPORT_COMMON_FILES!=""){var B=r.MO_IMPORT_COMMON_FILES.split(";");if(B.length<=0){return}for(var A=0;A<B.length;A++){if(!B[A]){continue}s(r.MO_APP+"Common/"+B[A]+".asp")}}u();l.assign("VERSION",l.Version);return true};l.Terminate=function(){k();if(Model__&&Model__.dispose){Model__.dispose()}F.dispose();d();o=null;this.Config=null;x=null};function t(c){var z=/^(.+?)(\?(.+))?$/.exec(c);if(z){var A=v(["","",""],z[1].split("/"));F.get(r.MO_GROUP_CHAR,A[0]);F.get(r.MO_METHOD_CHAR,A[1]);F.get(r.MO_ACTION_CHAR,A[2]);F.get.fromURIString(z[3])}}l.Route=function(){var D=req.QueryString+"",z="";var G=/^404\;http(s)?\:\/\/(.+?)\/(.*?)$/i.exec(D);if(G!=null){r.MO_ROUTE_MODE="404";l.IsRewrite=true;z="/"+G[3]}if(r.MO_ROUTE_MODE=="404"){if(F.server("HTTP_X_REWRITE_URL")!=""){z=F.server("HTTP_X_REWRITE_URL")}}else{if(r.MO_ROUTE_MODE=="URL"){z=D;l.IsRewrite=true;if(z==""){return}}else{return}}if(r.MO_ROOT!="/"&&z.substr(0,r.MO_ROOT.length)==r.MO_ROOT){z=z.substr(r.MO_ROOT.length-1)}if(r.MO_ROUTE_URL_EXT){z=z.replace(new RegExp("\\."+r.MO_ROUTE_URL_EXT+"$","i"),"");if(z.slice(0,1)=="/"){z=z.substr(1)}if(z.slice(-1)=="/"){z=z.substr(0,w.length-1)}}if(!z){return}var c=r.MO_ROUTE_MAPS;if(c&&c.hasOwnProperty(z)){t(c[z]);return}var B=F.server("REQUEST_METHOD"),H=r.MO_ROUTE_REST_ENABLED;var C=r.MO_ROUTE_RULES;for(var A=0;A<C.length;A++){var E=C[A];if(!E.Method){E.Method="GET"}if(E.LookFor.test(z)&&(!H||B==E.Method)){RouteTo=z.replace(E.LookFor,E.SendTo);break}}if(RouteTo){t(RouteTo)}};l.display=function(c,z){res.Status=this.Status;res.AddHeader("Content-Type","text/html; charset="+r.MO_CHARSET);l.fetch(c,z)};l.fetch=function(M,J){l.Buffer=!(arguments.callee.caller==l.display);var C=e.run();if(!M||M==""){M=l.Action}var I,D,B,E=false,G,A="";if(r.MO_COMPILE_CACHE){D=l.Method+"^"+l.Action+"^"+F.string.replace(M,/\:/igm,"^");if(J){D+="^"+J}A=F.mappath(r.MO_APP+"Cache/Compiled/"+D+".asp");if(IO.file.exists(A)){E=true;if(r.MO_COMPILE_CACHE_EXPIRED>0){B=F.fso.GetFile(A).DateLastModified;if(F.date.datediff("s",B,new Date())>=r.MO_COMPILE_CACHE_EXPIRED){E=false}}if(E){G=IO.file.readAllScript(A,r.MO_CHARSET)}}}if(!E){I=b(M,false);if(I==""){return""}if(!View){View=require("lib/view.js")}if(!View){ExceptionManager.put(77535,"Mo.fetch()","模板解析器加载失败！");return""}var H=new View();G=H.setContent(I).parse().Content;if(r.MO_COMPILE_CACHE){IO.file.writeAllText(A,'\u003cscript language="jscript" runat="server"\u003e\r\n'+G+"\r\n\u003c/script\u003e",r.MO_CHARSET)}}e.timelines.compile=e.ticks(C);if(r.MO_DEBUG){C=e.run();G=ReCompileForDebug(G,-1);e.timelines.recompile=e.ticks(C)}C=e.run();var z,K;try{z=new Function("$","__filename","__scripts","__buffer","__buffersize",G)}catch(L){ExceptionManager.put(L.number,"Mo.fetch()","已编译的模板代码包装错误："+L.description,E_ERROR);return}var c=A;if(r.MO_DEBUG){c+=";由模板["+h(M)+"."+r.MO_TEMPLATE_PERX+"]编译，请检查模板是否有语法错误或使用了未声明的变量。"}K=z(o,c,r.MO_DEBUG?G:"",l.Buffer,1024);if(r.MO_CACHE&&r.MO_CACHE_DIR!=""&&IO.directory.exists(r.MO_CACHE_DIR)){IO.file.writeAllText(F.mappath(r.MO_CACHE_DIR+p+".cache"),K,r.MO_CHARSET)}e.timelines.run1=e.ticks(C);return K};l.U=function(H,I,z){var C=/^(.*?)(\?(.*?))?(\#(.*?))?(\@(.*?))?(\!)?$/igm.exec(H||"");if(!C){return""}F.object.toURIString.fn=0;var H=C[1],E=F.object.fromURIString(C[3]),B=C[5],A=C[7],G=H.split("/"),c=r.MO_PROTOCOL+(A||r.MO_HOST)+r.MO_ROOT+r.MO_APP_ENTRY;if(I){if(typeof I=="string"){E=F.object.fromURIString(I)}else{if(typeof I=="object"){E=I}}}if(C[8]=="!"){c=r.MO_ROOT+r.MO_APP_ENTRY}var D=["?{0}={1}&{2}={3}&{4}={5}","?{0}={1}&{2}={3}"];if(r.MO_ROUTE_MODE=="404"){D=["{1}/{3}/{5}","{1}/{3}"]}else{if(r.MO_ROUTE_MODE=="URL"){D=["?/{1}/{3}/{5}","?/{1}/{3}"]}}if(G.length==3){c+=F.format(D[0],r.MO_GROUP_CHAR,G[0],r.MO_METHOD_CHAR,G[1],r.MO_ACTION_CHAR,G[2])}else{if(G.length==2){c+=F.format(D[1],r.MO_METHOD_CHAR,G[0],r.MO_ACTION_CHAR,G[1])}else{if(G.length==1&&H!=""){c+=F.format(D[1],r.MO_METHOD_CHAR,l.Method,r.MO_ACTION_CHAR,G[0])}else{c+=F.format(D[1],r.MO_METHOD_CHAR,l.Method,r.MO_ACTION_CHAR,l.Action)}}}if(r.MO_ROUTE_MODE=="404"||r.MO_ROUTE_MODE=="URL"){F.object.toURIString.split_char_1=F.object.toURIString.split_char_2="/";c+="/"+F.object.toURIString(E);F.object.toURIString.split_char_1="=";F.object.toURIString.split_char_2="&";if(z){c+="."+z}}else{c+="&"+F.object.toURIString(E)}if(F.string.endsWith(c,"/")||F.string.endsWith(c,"&")){c=c.substr(0,c.length-1)}if(B!=""){c+="#"+B}F.object.toURIString.fn=1;return c};l.L=function(z){if(!r.MO_LANGUAGE){ExceptionManager.put(5,"Mo.L(key)","未定义语言包");return""}var A=r.MO_LANGUAGE;if(z.indexOf(".")>0){A=z.substr(0,z.indexOf("."));z=z.substr(z.indexOf(".")+1)}var c=null;if(c=f(A,"Lang")){return c[z]}else{ExceptionManager.put(3,"Mo.L(key)","语言包["+A+"]无法加载,请检查语言包是否存在及正确")}};l.C=function(z,B){var A="";if(z.indexOf(".")>0){A=z.substr(z.indexOf(".")+1);z=z.substr(0,z.indexOf("."));if(z=="@"){z="Global"}}if(l.Config.hasOwnProperty(z)){if(A!=""&&B!==undefined){l.Config[z][A]=B}return(A==""?l.Config[z]:l.Config[z][A])}var c=null;if(c=f(z)){l.Config[z]=c;if(A!=""&&B!==undefined){l.Config[z][A]=B}return(A==""?l.Config[z]:l.Config[z][A])}else{ExceptionManager.put(3,"Mo.C(conf,value)","配置["+z+"]无法加载,请检查配置文件是否存在以及正确")}};l.C.SaveAs=function(c,A){if(!A){return}var z=F.mappath(r.MO_APP+"Conf/"+c+".asp");IO.file.writeAllText(z,'\u003cscript language="jscript" runat="server"\u003e\r\nreturn '+JSON.stringify(A)+";\r\n\u003c/script\u003e","utf-8")};l.C.Exists=function(c){return IO.file.exists(r.MO_APP+"Conf/"+c+".asp")};l.A=function(z){var c=F.mappath(r.MO_APP+"Controllers/"+z+"Controller.asp");if(!IO.file.exists(c)){c=F.mappath(r.MO_CORE+"Controllers/"+z+"Controller.asp")}if(IO.file.exists(c)){var A;if(r.MO_CONTROLLER_CNAMES&&r.MO_CONTROLLER_CNAMES.hasOwnProperty(z.toLowerCase())){z=r.MO_CONTROLLER_CNAMES[z.toLowerCase()]}if(A=m(c,z)){return new A()}else{ExceptionManager.put(5,"Mo.A(ctrl)","模块["+z+"]无法加载,请检查模块文件")}}else{ExceptionManager.put(6,"Mo.A(ctrl)","模块["+z+"]无法加载,请检查模块文件是否存在")}};l.Run=function(){var z=e.run();this.Method=F.get(r.MO_METHOD_CHAR);this.Action=F.get(r.MO_ACTION_CHAR);this.Group=F.get(r.MO_GROUP_CHAR);if(!/^(\w+)$/i.test(this.Action)){this.Action="Index"}if(!/^(\w+)$/i.test(this.Method)){this.Method="Home"}if(!/^(\w+)$/i.test(this.Group)){this.Group=""}if(this.Group!=""){this.Group+="/"}if(r.MO_CONTROLLER_CNAMES&&r.MO_CONTROLLER_CNAMES.hasOwnProperty(this.Method.toLowerCase())){this.Method=r.MO_CONTROLLER_CNAMES[this.Method.toLowerCase()]}if(r.MO_CACHE){p=MD5(F.server("URL")+F.get.toURIString()+"");if(IO.file.exists(r.MO_CACHE_DIR+p+".cache")){res.Write(IO.file.readAllText(F.mappath(r.MO_CACHE_DIR+p+".cache"),r.MO_CHARSET));return}}var D=r.MO_APP+"Controllers/"+this.Group+this.Method+"Controller.asp",C=true;this.RealMethod=this.Method;this.RealAction=this.Action;if(!IO.file.exists(D)){D=r.MO_APP+"Controllers/"+this.Group+"EmptyController.asp";this.RealMethod="Empty";if(!IO.file.exists(D)){D=r.MO_CORE+"Controllers/"+this.Group+this.Method+"Controller.asp";this.RealMethod=this.Method;if(!IO.file.exists(D)){D=r.MO_CORE+"Controllers/"+this.Group+"EmptyController.asp";this.RealMethod="Empty";if(!IO.file.exists(D)){if(l.templateIsInApp(this.Action)||l.templateIsInCore(this.Action)){l.display(this.Action);C=false}else{ExceptionManager.put(11772,this.RealMethod+"."+this.RealAction,"模块["+this.Method+"]不存在");return}}}}}var E;if(!(C&&(E=m(D,this.RealMethod)))){return}if(E.__PRIVATE__===true){ExceptionManager.put(11772,this.RealMethod+"."+this.RealAction,"模块["+this.Method+"]不存在");return}e.timelines.load=e.ticks(z);var B=new E(this.Action);if(B.__STATUS__===true){var A=this.Action;if(r.MO_ACTION_CASE_SENSITIVITY===false){A=A.toLowerCase()}var I=null,H=[],J=B;if(F.server("REQUEST_METHOD")=="POST"&&B[A+"_Post_"]&&B[A+"_Post_"]["__PRIVATE__"]!==true){I=B[A+"_Post_"]}else{if(B[A]&&B[A]["__PRIVATE__"]!==true){I=B[A]}else{if(r.MO_AUTO_DISPLAY&&(l.templateIsInApp(this.Action)||l.templateIsInCore(this.Action))){J=l;I=l.display;H=[this.Action]}else{if(B.empty&&B.empty["__PRIVATE__"]!==true){l.RealAction="empty";I=B.empty;H=[this.Action]}else{ExceptionManager.put(936,this.RealMethod+"."+this.RealAction,"未定义相应"+this.Action+"或empty方法。")}}}}if(r.MO_PARSEACTIONPARMS===true){H=y(I)}try{I&&I.apply(J,H)}catch(G){var c=new Exception(G.number,this.RealMethod+"."+this.RealAction,G.description);if(e.line>0){c.lineNumber=e.line;c.filename=e.file.replace(F.mappath("/"),"").replace(/\\/ig,"/");if(e.debugLine>0&&e.scripts!=""){c.traceCode=e.scripts.split("\n")[e.debugLine]}}ExceptionManager.put(c)}}B.__destruct();B=null};l.ModelCacheExists=function(c){if(c==""){return false}return F.exists(r.MO_APP+"Cache/Model/"+c+".cak")};l.ModelCacheSave=function(c,z){if(c==""){return false}return IO.file.writeAllText(F.mappath(r.MO_APP+"Cache/Model/"+c+".cak"),z,r.MO_CHARSET)};l.ModelCacheLoad=function(c){if(c==""){return""}return IO.file.readAllText(F.mappath(r.MO_APP+"Cache/Model/"+c+".cak"),r.MO_CHARSET)};l.ModelCacheDelete=function(c){if(c==""){return false}return IO.file.del(F.mappath(r.MO_APP+"Cache/Model/"+c+".cak"))};l.ModelCacheClear=function(){return IO.directory.clear(F.mappath(r.MO_APP+"Cache/Model"),function(c,z){if(z&&c.name==".mae"){return false}})};l.ClearCompiledCache=function(){return IO.directory.clear(F.mappath(r.MO_APP+"Cache/Compiled"),function(c,z){if(z&&c.name==".mae"){return false}})};l.templateIsInApp=function(z){var c=h(z),A;A=r.MO_APP+"Views/"+c+"."+r.MO_TEMPLATE_PERX;if(c.indexOf("@")>0){A=r.MO_ROOT+c.substr(c.indexOf("@")+1)+"/Views/"+c.substr(0,c.indexOf("@"))+"."+r.MO_TEMPLATE_PERX}return IO.file.exists(A)};l.templateIsInCore=function(z){var c,A;c=h(z);A=r.MO_CORE+"Views/"+c+"."+r.MO_TEMPLATE_PERX;return IO.file.exists(A)};l.assign=function(c,z){if(!/^(\w+)$/ig.test(c)){return ExceptionManager.put(11852,"Mo.assign","Parameter 'key' is invalid.")}o[c]=z};return l})();(function(){var e={base64:["e","d","encode","decode","toBinary","fromBinary","base64"],JSON:["parse","stringify","create","decodeStrict","encodeUnicode","assets/json.js"],IController:["create","IController@lib/dist.js"],IClass:["create","IClass@lib/dist.js"],dump:[null,"dump"],"cookie=Cookie":[null,"assets/cookie.js"],Model__:[null,"useCommand","Debug","setDefault","setDefaultPK","begin","commit","rollback","getConnection","dispose","connect","execute","executeQuery","Model__@lib/model.js"],DataTable:[null,"Model__.helper.DataTable@lib/model.js"],DataTableRow:[null,"Model__.helper.DataTableRow@lib/model.js"],VBS:["ns","include","eval","require","getref","execute","run","assets/vbs.js"],Mpi:["downloadAndInstall","Host","setDefaultInstallDirectory","download","fetchPackagesList","fetchPackage","packageExists","install","assets/mpi.js"],Tar:[null,"packFolder","packFile","unpack","assets/tar.js"],"md5=MD5":[null,"md5@assets/md5.js"],"md5_bytes=MD5Bytes":[null,"md5_bytes@assets/md5.js"]};var m=Mo.Runtime.run();for(var k in e){if(!e.hasOwnProperty(k)){continue}var l=e[k],b=l.pop(),h=b.indexOf("@"),c="",f="",j=k.indexOf("=");if(h>0){c="."+b.substr(0,h);b=b.substr(h+1)}(new Function(k+" = {};"))();if(j>0){f=k.substr(j+1);k=k.substr(0,j)}for(var d=0;d<l.length;d++){var a="."+l[d];if(l[d]==null){a=""}var g=k+a+" = function(){"+k+' = require("'+b+'")'+c+"; return "+k+a+".apply("+k+",arguments)};";(new Function(g))()}if(f){(new Function(f+" = "+k+";"))()}}})();var Encapsulate=Function.Create=function(a){var c=[];for(var d=0;d<a;d++){c.push("arg"+d)}var b=c.join(",");return new Function(b,"return new this("+b+");")};var E_NONE=0,E_ERROR=1,E_NOTICE=2,E_WARNING=4,E_INFO=8,E_ALL=E_ERROR|E_NOTICE|E_WARNING|E_INFO;var ExceptionManager=(function(){var e={};var l=[],k=E_ALL,g={1:"red",2:"orange",4:"blue",8:"green"};var f=function(b){var a="0000000"+b.toString(16).toUpperCase();return a.substr(a.length-8)};function i(a){return a==1?"E_ERROR":(a==2?"E_NOTICE":(a==4?"E_WARNING":"E_INFO"))}e.put=function(){var b=Array.prototype.slice.call(arguments,0),a=E_ERROR;if(typeof b[b.length-1]=="number"){a=b.pop()}if(b.length==1){if(b[0].constructor==Exception){l.push(b[0])}else{l.push(new Exception(b[0].number,"Microsoft.JScriptError",b[0].description,a))}}else{if(b.length==2){l.push(new Exception(b[0].number,b[1],b[0].description,a))}else{if(b.length==3){l.push(new Exception(b[0],b[1],b[2],a))}}}};e.putNotice=function(){var a=Array.prototype.slice.call(arguments,0);a.push(E_NOTICE);e.put.apply(null,a)};e.putWarning=function(b){var a=Array.prototype.slice.call(arguments,0);a.push(E_WARNING);e.put.apply(null,a)};e.errorReporting=function(a){if(arguments.length==0){return k}k=a};e.clear=function(){while(l.length>0){l.pop()}};e.debug=function(){if(l.length==0){return""}var a="";for(var b=0;b<l.length;b++){var c=l[b];if(c.level&k){a+=F.format('[<b>0x{0:X8}</b>] <span style="color:'+g[c.level]+'">{1}：{2} [{3}]</span>\r\n',c.Number,c.Source,F.encodeHtml(c.Description),i(c.level));if(c.filename){a+="  文件："+c.filename+"\r\n"}if(c.lineNumber>0){a+="  行号："+c.lineNumber+"\r\n"}if(c.traceCode){a+='  源码：<span style="color:red">'+c.traceCode+"</span>\r\n"}}}if(a==""){return""}return"<pre style=\"font-family:'Courier New';font-size:12px; padding:8px; background-color:#f6f6f6;border:1px #ddd solid;border-radius:5px;line-height:18px;\">"+a+"</pre>"};e.debug2file=function(){if(l.length==0){return""}var a="";for(var b=0;b<l.length;b++){var c=l[b];if(c.level&k){a+=F.format("{0}：{1} [{2}]\r\n",c.Source,F.encodeHtml(c.Description),i(c.level));if(c.filename){a+="  文件："+c.filename+"\r\n"}if(c.lineNumber>0){a+="  行号："+c.lineNumber+"\r\n"}if(c.traceCode){a+="  源码："+c.traceCode+"\r\n"}}}if(a==""){return}if(Mo.Config.Global.MO_DEBUG_FILE){IO.file.appendAllText(Mo.Config.Global.MO_DEBUG_FILE,a+"\r\n")}};return e})();function Exception(e,h,f,g){this.level=g||E_ERROR;this.levelString="E_ERROR";this.Number=e||0;if(this.Number<0){this.Number=this.Number+4294967296}this.Source=h||"";this.Message=f||"";this.Description=f||"";this.lineNumber=0;this.filename="";this.traceCode=""}var IO=(function(){var f=function(a){if(typeof a!="string"){return""}if(a.substr(1,1)==":"){return a}return Server.MapPath(a)};var e=function(b,c){for(var a in c){if(c.hasOwnProperty(a)){b[a]=c[a]}}return b};var d=(function(){var a={};a.resolve=f;a.is=function(b){if(b.length<2){return false}return b.substr(1,1)==":"};a.fso=new ActiveXObject("scripting.filesystemobject");a.parent=function(b){return a.fso.GetParentFolderName(f(b))};a.absolute=function(b){return a.fso.GetAbsolutePathName(f(b))};a.base=function(b){return a.fso.GetBaseName(f(b))};a.parent=function(b){return a.fso.GetParentFolderName(f(b))};a.build=function(c,b){return a.fso.GetAbsolutePathName(a.fso.BuildPath(f(c),b))};a.stream=function(b,h){var c=new ActiveXObject("adodb.stream");c.mode=b||3;c.type=h||1;return c};a.fps=[];return a})();d.file=d.file||(function(){var a={};a.exists=function(b){b=f(b);return d.fso.fileexists(b)};a.readAllText=function(b,c){return(function(j){var i=d.file.read(j);d.file.close(j);return i})(d.file.open(b,{forText:true,forRead:true,encoding:c||"utf-8"}))};a.readAllScript=function(b,c){var h=(function(j){var g=d.file.read(j);d.file.close(j);return g})(d.file.open(b,{forText:true,forRead:true,encoding:c||"utf-8"}));h=h.replace(new RegExp("^(\\s*)\\u003cscript(.+?)\\u003e(\\s*)","i"),"").replace(new RegExp("(\\s*)\\u003c\\/script\\u003e(\\s*)$","i"),"");return h};a.open=function(b,c){b=f(b);var j={forAppend:false,forText:true,forRead:false,encoding:"utf-8"};e(j,c||{});var i=d.stream(3,j.forText?2:1);if(j.forText){i.charset=j.encoding}i.open();if(a.exists(b)&&(j.forAppend||j.forRead)){i.loadfromfile(b);if(j.forAppend){i.position=i.size}}d.fps.push([i,b,j]);return d.fps.length-1};a.read=function(c,b){if(!d.fps[c]){ExceptionManager.put(11598,"io.file.read","file resource id is invalid.");return null}if(d.fps[c][2].forText){if(b){return d.fps[c][0].readText(b)}return d.fps[c][0].readText()}else{if(b){return d.fps[c][0].read(b)}return d.fps[c][0].read()}};a.close=function(b){if(!d.fps[b]){ExceptionManager.put(11630,"io.file.close","file resource id is invalid.");return}d.fps[b][0].close()};return a})();d.directory=d.directory||(function(){var a={};a.exists=function(b){return d.fso.folderexists(f(b))};a.files=function(h,i){if(!a.exists(h)){return[]}var c=[];var b=new Enumerator(d.fso.getFolder(f(h)).files);var g=(typeof i=="function");for(;!b.atEnd();b.moveNext()){if(g){i(b.item())}else{c.push(b.item().path)}}return c};return a})();return d})();